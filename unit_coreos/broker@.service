[Unit]
Description=broker


[Service]
ExecStartPre=-/usr/bin/docker kill broker-%i
ExecStartPre=-/usr/bin/docker rm broker-%i
ExecStartPre=/usr/bin/docker pull rabbitmq:3.5.3
ExecStartPre=/usr/bin/etcdctl set /services/s9/broker/host ${COREOS_PRIVATE_IPV4}
ExecStartPre=/usr/bin/etcdctl set /services/s9/broker/port 5672
ExecStart=/usr/bin/docker run --name broker-%i -p 5672:5672 rabbitmq:3.5.3
ExecStop=/usr/bin/docker stop broker-%i

[X-Fleet]
Conflicts=broker@*.service
